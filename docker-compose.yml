services:
  abricol-bot:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: abricol-assistant
    restart: unless-stopped
    
    # Переменные окружения из .env файла
    env_file:
      - .env
    
    # Переменные окружения (можно переопределить в .env)
    environment:
      - PYTHONUNBUFFERED=1
      - PYTHONPATH=/app
      # Переменные для кэша моделей faster-whisper
      - HF_HOME=/app/.cache/huggingface
      - XDG_CACHE_HOME=/app/.cache
      - TMPDIR=/tmp
    
    # Монтирование томов для сохранения данных
    volumes:
      # База данных SQLite
      - ./abricol.db:/app/abricol.db
      # База знаний
      - ./knowledge.db:/app/knowledge.db
      # Excel файл с лидами
      - ./leads.xlsx:/app/leads.xlsx
      # Данные базы знаний (PDF, изображения, структурированные тексты)
      - ./src/knowledge/data:/app/src/knowledge/data
      # Логи (опционально)
      - ./bot.log:/app/bot.log
      # Кэш моделей faster-whisper (для ускорения последующих запусков)
      - ./cache/models:/app/.cache/huggingface
      # Временные файлы (создается автоматически в контейнере)
    
    # Сеть (если нужна)
    networks:
      - abricol-network
    
    # Ограничения ресурсов (опционально)
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 2G
        reservations:
          cpus: '0.5'
          memory: 512M

networks:
  abricol-network:
    driver: bridge

